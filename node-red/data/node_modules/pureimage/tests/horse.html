<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        body, html { padding: 0; margin:0; }
        canvas {
            border:1px solid red;
            padding:0;
            margin:0;
        }
    </style>
</head>
<body>
<canvas id="canvas" width="800" height="800"></canvas>
<script>
    const $ = sel => document.querySelector(sel)
    const on = (el, type, cb) =>  el.addEventListener(type,cb)
    const SVG_PATH = `m 344.91636,172.89546 4.41716,24.78531
    c 1.92991,10.82901 -3.77924,15.85977 -11.77917,17.42338 -29.90314,5.84461 -67.09534,23.04429 -105.52165,37.79145 -6.93031,2.65974 -20.29741,-1.4225 -22.82208,4.90801 -1.67059,4.189 -1.49341,6.93823 -4.17182,15.21472 -2.09273,6.46676 -1.56078,13.67535 10.30679,10.30679 15.76275,-4.47418 26.46438,-8.15711 29.4479,-4.90801 9.65484,10.51464 11.2346,16.38584 0.98162,19.14119 -6.45805,1.73546 -16.61659,-0.52065 -29.4479,5.88955 1.46125,10.89552 3.83831,19.70961 18.65034,13.74233 24.82649,-10.00175 37.94605,-13.60656 52.5154,-12.76071 10.1038,0.58661 22.11083,1.02397 17.66873,24.04912 -0.59933,3.10635 -1.20736,6.61342 -3.43555,22.57673 -0.76066,5.44937 -5.92006,11.69658 -11.77917,17.66872 -30.64898,31.23999 -73.31079,51.02513 -80.49099,106.50327 -1.6735,12.93029 -11.57799,9.71892 -14.23311,8.34356 -14.72802,-7.62925 -27.01185,-15.6051 -32.39267,-21.10435 -12.05284,-12.3181 -26.26876,-11.57391 -40.7363,-5.88955 -18.18358,7.14444 -34.667847,14.27114 -49.079857,16.68711 -12.24171,2.05218 -21.16796,4.55167 -24.53989,13.74241 -2.82336,7.69536 -9.74817,13.56083 -19.14111,18.15949 -3.86176,1.89068 -6.67932,3.38966 -8.34363,15.70557 l -4.90792,36.31906 33.37428,-10.30679 c 9.49639,-2.93269 9.17481,-8.9253 4.41716,-13.74233 -12.06241,-12.21276 -12.78119,-13.63613 -11.77918,-19.14111 1.75632,-9.64903 14.48276,0.0995 21.59512,2.94478 9.77358,3.90984 10.05218,-0.11562 11.77917,-3.43563 8.29979,-15.95561 26.729177,-17.79869 40.245457,-26.50304 15.70329,-0.57148 24.31619,2.40223 34.84668,4.41716 l 41.22707,39.75469 c 2.91144,2.80743 5.31619,12.17966 -7.36193,7.36193 l -24.53997,-9.32517 c -8.53282,-3.24244 -10.22702,-5.44772 -14.72395,-4.41716 l -23.55827,5.39878 c -9.15168,2.09728 -12.3043,6.47162 -13.25157,9.32517 -7.69214,23.1719 -19.730627,30.93597 -29.938737,46.135 -2.67237,3.97903 -4.14421,7.1413 -5.39878,17.17796 l -2.45401,19.63196 c -11.51037,10.23447 -4.8724,39.75155 -2.45392,64.78542 l 32.883437,-29.93874 c 6.01826,-5.47926 2.00661,-9.38683 -0.98154,-11.28833 l -10.797637,-6.87117 c -4.36555,-2.7781 -6.45216,-8.8344 -2.94477,-13.25156 l 21.104347,0.49077 c -3.99997,-11.46889 -5.66805,-22.29884 2.454,-33.37429 l 21.59512,-29.4479 c 3.90741,-5.32827 15.92071,-11.10651 27.97551,-4.41716 l 84.90815,47.11662 c 6.28463,3.48739 14.08776,3.86388 19.14111,-2.94477 6.45829,-8.70169 16.00511,-8.13115 24.53989,-2.94478 45.67836,27.75739 95.86651,28.05505 152.14752,15.70549 5.60287,-1.22939 18.75827,-5.09719 13.25156,10.30679 -12.29873,34.40367 -4.70258,48.9833 8.8344,63.80381 l 26.01228,27.97551 c 12.31011,13.23917 24.17478,30.32088 1.96324,47.11662 -10.11541,7.64901 -18.70376,15.65215 -27.48475,24.04912 -41.59179,0.40445 -47.25686,32.04945 -60.36818,57.21944 l 56.44179,0 c -17.67445,-11.8929 -19.41587,-21.27009 -12.26994,-29.24399 l 20.12273,0 c 12.05064,0 11.84616,-5.1679 12.76079,-9.3251 2.40106,-10.9134 1.96316,-10.074 2.94477,-12.7608 l 29.4479,-21.10427 c 9.15489,-6.56103 8.6951,-11.51461 9.81594,-16.19633 6.06171,-1.00962 12.81436,-3.22605 21.53409,-8.05233 11.54513,-6.3902 10.20835,-14.47554 2.0823,-23.25214 -15.60784,-16.85739 -19.81597,-26.30523 -27.41674,-40.25745 -7.19627,-13.20976 -6.28517,-22.259 -3.12344,-29.15197 7.63331,-16.64169 13.73566,-6.89932 15.27009,-1.73522 7.61222,25.61955 29.87294,39.98191 51.01587,57.95685 10.0558,8.54905 21.2558,15.33606 5.89983,39.5633 -14.96428,23.60918 -33.59376,37.80936 -52.7511,53.44526 -15.46666,12.6236 -19.3714,26.45889 -23.94629,40.11419 l 51.36295,0 c -14.3524,-8.3905 -15.03769,-18.7594 -9.71735,-26.92639 4.26602,-6.5486 13.74876,-6.232 21.51692,-2.7764 6.45381,2.8709 9.21834,0.6227 10.41142,-2.7764 22.58558,-64.34403 32.7715,-59.61932 52.05701,-81.55602 14.01858,-15.94566 6.25216,-19.73989 0.34708,-24.98736 -33.66505,-29.91585 -44.54535,-61.85728 -26.37559,-90.92626 13.88822,-22.21915 23.70918,-42.8859 13.18779,-76.00332 6.64159,-10.92015 69.82623,-22.08212 53.09818,30.19311 l -16.65824,52.05703 c -24.59158,76.84861 53.45168,88.16534 70.79757,81.90306 -13.91615,-18.51143 -14.60356,-35.8137 -10.41143,-53.44517 l 23.59922,-99.25546 c 16.5569,-69.63633 -45.74275,-93.78365 -80.51491,-55.52747 -15.2188,16.74366 -30.46325,25.15945 -49.97473,15.27001 -28.56424,-49.94248 -66.47068,-41.10597 -97.86722,-40.25737 l -77.04439,2.08222 c -39.83179,1.0766 -51.87059,-19.73746 -47.19836,-45.81013 0,0 13.38821,0.57838 15.9641,-5.72632 2.57589,-6.30463 -12.8535,-14.75054 -10.41134,-21.51692 2.44216,-6.7663 14.69618,-1.88088 17.52581,-7.98204 2.82963,-6.10117 -7.97616,-14.28997 -5.72624,-20.30227 2.24991,-6.01222 12.32743,-2.86461 14.57594,-9.54377 2.2485,-6.67916 -10.22498,-16.43509 -8.32912,-23.42564 1.89586,-6.99054 12.98174,-4.52854 14.22894,-11.97315 1.2472,-7.4446 -14.67093,-14.93517 -13.70837,-22.90506 0.96256,-7.96989 15.748,-7.55324 15.09652,-15.27009 -0.65148,-7.71678 -16.68569,-2.54146 -19.56599,-12.12194 -2.88031,-9.58056 9.60455,-13.4173 7.24585,-19.9799 -2.35871,-6.56252 -17.07638,-3.22447 -20.30227,-9.89084 -3.22589,-6.6663 8.0793,-16.26317 4.68517,-21.34334 -3.39413,-5.08018 -14.57595,-2.60288 -14.57595,-2.60288 -5.0386,-2.39894 -8.54654,-7.52171 -10.63919,-11.58324 -6.02501,-11.69392 -20.30628,-32.96549 -31.9318,-38.75252 z`;
    // const SVG_PATH_2 = `M 213.1,6.7
  // c -32.4,-14.4 -73.7,0 -88.1,30.6
  // C 110.6,4.9,67.5-9.5,36.9,6.7
  // C 2.8,22.9-13.4,62.4,13.5,110.9
  // C 33.3,145.1,67.5,170.3,125,217
  // c 59.3-46.7,93.5-71.9,111.5-106.1
  // C 263.4,64.2,247.2,22.9,213.1,6.7
  // z`

    // const SVG_PATH = `M 25,50	C 25,100	  150,100	  150,50`
    const paths = parseSVGPath(SVG_PATH)

    function parseSVGPath(path) {
        path = path.split('\t').join(" ")
        path = path.split(",").join(" ")
        path = path.split("- ").join(" -")
        const parts = path.split(' ')
            .map(s => s.trim())
            .filter(s => s !== '')
        console.log("parts",parts)
        return parts
    }
    function parsePoint(arr) {
        return {
            x:parseFloat(arr.shift()),
            y:parseFloat(arr.shift())
        }
    }
    function redraw() {
        const canvas = document.querySelector('#canvas')
        const ctx = canvas.getContext('2d')
        ctx.fillStyle = 'white'
        ctx.fillRect(0,0,canvas.width,canvas.height)
        ctx.strokeStyle = 'black'
        ctx.save()
        ctx.scale(1,1)
        ctx.translate(0,-150)

        function drawPaths(ctx) {

            let cur = {x:0, y:0}
            ctx.beginPath()
            let count = 0
            let command = ''


            while(paths.length > 0 && count < 200) {
                count++
                let token = paths.shift()
                // console.log("token",token)
                if(isNumber(token)) {
                    // console.log("it's still a number. continuing with previous command",command)
                    paths.unshift(token)
                } else {
                    console.log("not a number. doing command")
                    command = token
                }
                if(command === 'M') {
                    cur = parsePoint(paths)
                    ctx.moveTo(cur.x,cur.y)
                    console.log("Moving to",cur)
                }
                if(command === 'm') {
                    cur = addPoints(cur,parsePoint(paths))
                    ctx.moveTo(cur.x,cur.y)
                    // console.log("Moving to",cur)
                }
                if(command === 'l') {
                    const p2 = addPoints(cur,parsePoint(paths))
                    ctx.lineTo(p2.x,p2.y)
                    // console.log("line to", p2)
                    cur = p2
                }
                if(command === 'c') {
                    const cp1 = addPoints(cur,parsePoint(paths))
                    const cp2 = addPoints(cur,parsePoint(paths))
                    const p2  = addPoints(cur,parsePoint(paths))
                    ctx.bezierCurveTo(cp1.x,cp1.y,cp2.x,cp2.y,p2.x,p2.y)
                    // console.log("curving",cp1,cp2,p2)
                    cur = p2
                }
                if(command === 'z') {
                    console.log("close")
                }
            }
            ctx.stroke()
        }



        // drawPaths(ctx)
        drawPaths(makeCustomContext(ctx))


        console.log("done")
        ctx.restore()
    }

    function isNumber(str) {
        return !isNaN(parseFloat(str))
    }
    function addPoints(p1, p2) {
        return {
            x:p1.x+p2.x,
            y:p1.y+p2.y
        }
    }
    redraw()


    function round(pt) {
        return {
            x: Math.floor(pt.x/10)*10,
            y: Math.floor(pt.y/10)*10,
        }
    }
    function per(pt) {
        const r = 10
        return {
            x: pt.x + (r-Math.random()*r*2),
            y: pt.y + (r-Math.random()*r*2)
        }
    }
    function makeCustomContext(ctx) {
        function drawCurve(curve) {
            let prev = calcBezierAtT(curve, 0)
            for (let t = 0; t <= 1.0; t += 0.1) {
                let curr = calcBezierAtT(curve, t)
                // prev = round(prev)
                // curr = round(curr)
                ctx.moveTo(prev.x,prev.y)
                ctx.lineTo(curr.x,curr.y)
                prev = curr
            }
        }
        function calcBezierAtT(p, t) {
            // (1-t)^3*A + 3*(1-t)^2*t*B + 3*(1-t)*t^2*C + t*3*D
            const x = (1-t)*(1-t)*(1-t)*p[0].x + 3*(1-t)*(1-t)*t*p[1].x + 3*(1-t)*t*t*p[2].x + t*t*t*p[3].x;
            const y = (1-t)*(1-t)*(1-t)*p[0].y + 3*(1-t)*(1-t)*t*p[1].y + 3*(1-t)*t*t*p[2].y + t*t*t*p[3].y;
            return {x, y}
        }
        function pt(x,y) {
            return {x:x, y:y}
        }

        return {
            cur: {x:0,y:0},
            beginPath: function() {
                ctx.beginPath()
            },
            moveTo: function(x,y) {
                this.cur = {x:x,y:y}
                ctx.moveTo(x,y)
            },
            bezierCurveTo: function(cx1,cy1,cx2,cy2,x1,y1) {
                // ctx.bezierCurveTo(cx1,cy1,cx2,cy2,x1,y1)
                drawCurve([per(this.cur),(pt(cx1,cy1)),(pt(cx2,cy2)),per(pt(x1,y1))])
                this.cur = pt(x1,y1)
            },
            lineTo: function(x,y) {
                ctx.lineTo(x,y)
                this.cur = pt(x,y)
            },
            stroke: function() {
                ctx.stroke()
            },
        }
    }
</script>
</body>
</html>